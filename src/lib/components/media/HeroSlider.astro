---
import type { MediaItem } from '@type/api';
import { formatRating, extractDetailPath } from '@lib/utils/helpers';
import Button from '@components/ui/Button.astro';
import Badge from '@components/ui/Badge.astro';

interface Props {
  items: (MediaItem & { description?: string })[];
}

const { items } = Astro.props;
---

<div class="hero-slider relative h-[85vh] w-full overflow-hidden bg-zinc-950">
  <div class="swiper-wrapper flex h-full transition-transform duration-700 ease-[cubic-bezier(0.23,1,0.32,1)]">
    {items.map((item) => (
      <div class="swiper-slide relative h-full w-full flex-shrink-0">
        <!-- Netflix-style Background Backdrop -->
        <div class="absolute inset-0">
          <img 
            src={item.poster} 
            alt={item.title}
            class="h-full w-full object-cover lg:object-[center_20%] grayscale-[20%]"
          />
          <div class="absolute inset-x-0 bottom-0 h-2/3 bg-gradient-to-t from-zinc-950 via-zinc-950/80 to-transparent"></div>
          <div class="absolute inset-y-0 left-0 w-full lg:w-2/3 bg-gradient-to-r from-zinc-950 via-zinc-950/60 to-transparent hidden lg:block"></div>
        </div>

        {/* <!-- Content Overlay --> */}
        <div class="relative flex h-full items-center px-4 sm:px-6 lg:px-12 max-w-7xl mx-auto">
          <div class="flex flex-col lg:flex-row gap-12 items-center lg:items-end w-full">
            
            {/* <!-- Poster Card ("The Cover") --> */}
            <div class="hidden lg:block w-72 aspect-[2/3] relative bg-zinc-900 border-4 border-black shadow-[12px_12px_0px_0px_rgba(99,102,241,1)] overflow-hidden shrink-0 translate-y-12">
               <img src={item.poster} alt={item.title} class="h-full w-full object-cover" />
            </div>

            <div class="flex-1 space-y-6 pb-12">
                <div class="flex flex-wrap items-center gap-3">
                <Badge variant="indigo" className="brutalist-border-sm bg-indigo-500 text-black font-black">{item.year}</Badge>
                <div class="flex items-center gap-1 bg-yellow-400 text-black px-2 py-1 border-2 border-black font-black text-xs shadow-[2px_2px_0px_0px_white]">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                    <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                    </svg>
                    <span>{formatRating(item.rating)}</span>
                </div>
                <span class="text-white font-black uppercase text-xs tracking-widest bg-black/40 backdrop-blur-sm px-3 py-1 border-2 border-white/10 italic">
                    {item.type}
                </span>
                </div>

                <h1 class="text-5xl sm:text-7xl lg:text-8xl font-black tracking-tighter text-white leading-[0.9] uppercase italic drop-shadow-2xl">
                {item.title}
                </h1>

                {item.description && (
                <p class="text-zinc-200 text-sm sm:text-base font-bold uppercase tracking-wide leading-relaxed overflow-hidden max-w-xl text-shadow bg-black/40 backdrop-blur-md p-4 border-l-4 border-indigo-500">
                    {item.description}
                </p>
                )}

                <div class="flex flex-wrap items-center gap-6 pt-4">
                <Button href={`/detail/${extractDetailPath(item.detailPath)}`} size="lg" className="shadow-[8px_8px_0px_0px_white]">
                    Play Now
                </Button>
                <Button variant="secondary" size="lg" href={`/detail/${extractDetailPath(item.detailPath)}`} className="bg-white/10 backdrop-blur-md text-white border-white/20 shadow-[8px_8px_0px_0px_rgba(255,255,255,0.1)]">
                    More Info
                </Button>
                </div>
            </div>
          </div>
        </div>
      </div>
    ))}
  </div>

  <!-- Navigation -->
  <div class="absolute bottom-8 right-12 flex gap-4 z-10">
    {items.map((_, i) => (
      <button 
        class={`hero-dot w-3 h-3 border-2 border-black rotate-45 transition-all duration-300 ${i === 0 ? 'bg-indigo-500 scale-125 shadow-[4px_4px_0px_0px_white]' : 'bg-zinc-700'}`}
        data-index={i}
      ></button>
    ))}
  </div>
</div>

<script>
  const slider = document.querySelector('.swiper-wrapper') as HTMLElement;
  const slides = document.querySelectorAll('.swiper-slide');
  const dots = document.querySelectorAll('.hero-dot');
  let current = 0;

  function update() {
    if (!slider) return;
    slider.style.transform = `translateX(-${current * 100}%)`;
    dots.forEach((dot, i) => {
      dot.classList.toggle('bg-indigo-500', i === current);
      dot.classList.toggle('scale-125', i === current);
      dot.classList.toggle('shadow-[4px_4px_0px_0px_white]', i === current);
      dot.classList.toggle('bg-zinc-700', i !== current);
    });
  }

  setInterval(() => {
    current = (current + 1) % slides.length;
    update();
  }, 7000);

  dots.forEach(dot => {
    dot.addEventListener('click', () => {
      current = parseInt(dot.getAttribute('data-index') || '0');
      update();
    });
  });
</script>


