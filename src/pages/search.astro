---
import BaseLayout from "@components/layout/BaseLayout.astro";
import MediaGrid from "@components/media/MediaGrid.astro";
import { api } from "@lib/api/client";
import type { ApiResponse } from "../types/api";

const query = Astro.url.searchParams.get("q") || "";
const page = parseInt(Astro.url.searchParams.get("page") || "1");

let results: ApiResponse = { success: true, items: [] };
if (query) {
  results = await api.search(query, page);
}
---

<BaseLayout
  title={`Cari: ${query}`}
  description={`Hasil pencarian untuk "${query}"`}
>
  <div
    class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-24 sm:py-32 min-h-screen"
  >
    <div class="space-y-12">
      <!-- Search Header -->
      <div class="space-y-4 text-center md:text-left">
        <h1 class="text-4xl sm:text-5xl font-black tracking-tight text-white">
          Hasil Pencarian
        </h1>
        <p class="text-zinc-500 font-medium">
          Ditemukan beberapa hasil untuk kata kunci <span
            class="text-indigo-400 underline italic">"{query}"</span
          >
        </p>
      </div>

      <!-- Results Grid -->
      <section class="space-y-8">
        {
          results.items.length > 0 ? (
            <MediaGrid
              items={results.items}
              fetchType="search"
              fetchParams={{ q: query }}
            />
          ) : (
            <div class="flex flex-col items-center justify-center py-20 text-zinc-600">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-24 w-24 mb-4 opacity-10"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="1.5"
                  d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
                />
              </svg>
              <p class="text-xl font-bold italic">
                Tidak ada hasil yang ditemukan.
              </p>
            </div>
          )
        }
      </section>

      <!-- Pagination (Simple) -->
      {
        results.hasMore && (
          <div class="flex justify-center pt-8">
            <a
              href={`/search?q=${query}&page=${page + 1}`}
              class="inline-flex items-center justify-center rounded-full bg-zinc-800 px-8 py-3 text-sm font-bold text-zinc-100 hover:bg-zinc-700 transition-all"
            >
              Muat Lebih Banyak
            </a>
          </div>
        )
      }
    </div>
  </div>
</BaseLayout>
